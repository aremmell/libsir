Standard Incident Reporter; simple logging to file, debug and stdout/stderr

\begin{quote}
N\+O\+TE\+: This code is ancient; I wrote it in 2003. It may not compile at all. I have placed it here for posterity. \end{quote}


\subsection*{Description}

Sir is a cross-\/platform A\+N\+SI C library that provides developers with much needed, usually repetitive functionality. Any application of moderate size or complexity requires program output to be sent to various locations, namely the console, log files, a debug window, or G\+UI. Writing the code to do this is painfully repetitious. Enter Sir.

By adding sir to your application\textquotesingle{}s code base, you can perform information output tasks in no time flat. Sir provides functionality that allows you to easily send formatted output to one or more of these destinations simultaneously with one function call\+:


\begin{DoxyItemize}
\item stdout/stderr
\item Log files
\item Callback functions
\item Debug (Windows)
\end{DoxyItemize}

Sir has the capability to prepend output with a standard format timestamp (time()/ctime()), and append carriage return/line feed. Also, Sir may be implemented in C++ applications.

\subsubsection*{Types and return values}

Sir uses the type T\+C\+H\+AR frequently. This type is simply either an 8-\/bit character when the program being built is A\+N\+SI, or a 16-\/bit character when the program is in U\+N\+I\+C\+O\+DE mode. In addition, Sir makes use of the macro \+\_\+T, which, on Windows if U\+N\+I\+C\+O\+DE is being used, transforms string literals to L\char`\"{}\+String\char`\"{}. If you\textquotesingle{}re not using Sir on Windows, you do not need to worry about the \+\_\+T macro.

All Sir functions return type int unless otherwise specified. The success code is zero, and if an error occurs, -\/1 will be returned.

\subsubsection*{Implementation}

Implementing Sir in your application is extremely easy. I have provided it in various forms, including source code, compiled static libraries (debug/release, A\+N\+S\+I/\+U\+N\+I\+C\+O\+DE builds), and a makefile for a shared library. The following section will show example usage.

\#\#\# Example 
\begin{DoxyCode}
\textcolor{preprocessor}{#include "\hyperlink{sir_8h}{sir.h}"}

\textcolor{comment}{/*}
\textcolor{comment}{  Sir type callback function}
\textcolor{comment}{*/}
\textcolor{keywordtype}{void} SirCallback(TCHAR *out, u\_long data);

\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, TCHAR *argv[]) \{
  \hyperlink{structsirinit}{sirinit} ss = \{0\}; \textcolor{comment}{/* Declare the Sir initialization structure */}

\textcolor{comment}{/*}
\textcolor{comment}{  Output of types SIRL\_LOG and SIRT\_WARNING}
\textcolor{comment}{  will be sent to stdout.}
\textcolor{comment}{ */}
  ss.f\_stdout = SIRL\_LOG | SIRT\_WARNING;

\textcolor{comment}{/*}
\textcolor{comment}{  Output of type SIRL\_WARNING will be sent}
\textcolor{comment}{  to debug.}
\textcolor{comment}{ */}
  ss.f\_debug = SIRT\_WARNING;

\textcolor{comment}{/*}
\textcolor{comment}{  Output of types SIRL\_ERROR and SIRT\_CRIT}
\textcolor{comment}{  will be sent to stderr.}
\textcolor{comment}{ */}
  ss.f\_stderr = \hyperlink{sir_8h_a06fc87d81c62e9abb8790b6e5713c55ba9c687f088db1de838ea5d5f8a8beed76}{SIRL\_ERROR} | SIRT\_CRIT;

\textcolor{comment}{/*}
\textcolor{comment}{  Set the option bits (Sir.h);}
\textcolor{comment}{  SIRO\_CRLF = \(\backslash\)r\(\backslash\)n will be appended to output,}
\textcolor{comment}{  SIRO\_TIMESTAMP = Time will be prepended to output,}
\textcolor{comment}{  SIRO\_FILES = Sir will handle file output,}
\textcolor{comment}{  SIRO\_CALLBACKS = Sir will handle callback output}
\textcolor{comment}{ */}
  ss.opts = SIRO\_CRLF | SIRO\_TIMESTAMP | SIRO\_FILES | SIRO\_CALLBACKS;

\textcolor{comment}{/*}
\textcolor{comment}{  Initialize the Sir system.}
\textcolor{comment}{ */}

  \textcolor{keywordflow}{if}(0 != Sir\_Init(&ss)) \{
    printf(\textcolor{stringliteral}{"Failed to initialize the Sir system!\(\backslash\)n"});
    \textcolor{keywordflow}{return} 1;
  \} \textcolor{keywordflow}{else} \{
    printf(\textcolor{stringliteral}{"Successfully initialized the Sir system.\(\backslash\)n"});
  \}

\textcolor{comment}{/*}
\textcolor{comment}{  Add a file for output of types SIRL\_WARNING and SIRT\_LOG.}
\textcolor{comment}{ */}
  \textcolor{keywordflow}{if}(0 != Sir\_AddFile(\_T(\textcolor{stringliteral}{"sir.log"}), \hyperlink{sir_8h_a06fc87d81c62e9abb8790b6e5713c55ba1ff2ba86cf1863e3673e5f534e021181}{SIRL\_WARNING} | SIRT\_LOG)) \{
    printf(\textcolor{stringliteral}{"Failed to add file to Sir system!\(\backslash\)n"});
  \} \textcolor{keywordflow}{else} \{
    printf(\textcolor{stringliteral}{"Successfully associated 'sir.log' with SIRT\_WARNING"}
           \textcolor{stringliteral}{" and SIRL\_LOG output types.\(\backslash\)n"});
  \}

\textcolor{comment}{/*}
\textcolor{comment}{  Add a callback for output types of SIRT\_SCREEN.}
\textcolor{comment}{ */}
  \textcolor{keywordflow}{if}(0 != Sir\_AddCallback(SirCallback, SIRL\_SCREEN, 0U)) \{
    printf(\textcolor{stringliteral}{"Failed to add callback to Sir system!\(\backslash\)n"});
  \} \textcolor{keywordflow}{else} \{
    printf(\textcolor{stringliteral}{"Successfully associated SirCallback() with SIRT\_SCREEN"}
           \textcolor{stringliteral}{" output type.\(\backslash\)n"});
  \}

\textcolor{comment}{/*}
\textcolor{comment}{  Send output to all its destinations with one call!}
\textcolor{comment}{ */}

\textcolor{comment}{/*}
\textcolor{comment}{  Sent to all destinations associated with type SIRL\_WARNING or SIRT\_LOG}
\textcolor{comment}{  (or both).}
\textcolor{comment}{ */}
  Sir(\hyperlink{sir_8h_a06fc87d81c62e9abb8790b6e5713c55ba1ff2ba86cf1863e3673e5f534e021181}{SIRL\_WARNING} | SIRT\_LOG, \_T(\textcolor{stringliteral}{"This is a test of the Sir system. This is"})
      \_T(\textcolor{stringliteral}{" only a test. %d, %d, %d"}), 1, 2, 3);

\textcolor{comment}{/*}
\textcolor{comment}{  Sent to all destinations associated with type SIRL\_ERROR or SIRT\_SCREEN}
\textcolor{comment}{  (or both).}
\textcolor{comment}{ */}
  Sir(\hyperlink{sir_8h_a06fc87d81c62e9abb8790b6e5713c55ba9c687f088db1de838ea5d5f8a8beed76}{SIRL\_ERROR} | SIRT\_SCREEN, \_T(\textcolor{stringliteral}{"This is a continuation of the Sir system"})
      \_T(\textcolor{stringliteral}{" test."}));

\textcolor{comment}{/*}
\textcolor{comment}{  Remove the file and callback (disassociates them with output types).}
\textcolor{comment}{ */}
  Sir\_RemFile(\_T(\textcolor{stringliteral}{"sir.log"}));

  Sir\_RemCallback (SirCallback);

\textcolor{comment}{/*}
\textcolor{comment}{  Free allocated resources and reset}
\textcolor{comment}{  the system's state}
\textcolor{comment}{ */}

  Sir\_Cleanup ();

  \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCode}


\subsubsection*{Constants}

\paragraph*{Options}


\begin{DoxyItemize}
\item {\ttfamily S\+I\+R\+O\+\_\+\+T\+I\+M\+E\+S\+T\+A\+MP} \+: Output will be prepended with a timestamp.
\item {\ttfamily S\+I\+R\+O\+\_\+\+C\+R\+LF} \+: Output will be appended with a carriage return and line feed.
\item {\ttfamily S\+I\+R\+O\+\_\+\+F\+I\+L\+ES} \+: Enables the use of disk files for output.
\item {\ttfamily S\+I\+R\+O\+\_\+\+C\+A\+L\+L\+B\+A\+C\+KS} \+: Enables the use of callback functions for output.
\item {\ttfamily S\+I\+R\+O\+\_\+\+D\+E\+F\+A\+U\+LT} \+: Functionally equivalent to S\+I\+R\+O\+\_\+\+T\+I\+M\+E\+S\+T\+A\+MP and S\+I\+R\+O\+\_\+\+C\+R\+LF. Sir will use this option if none are specified.
\end{DoxyItemize}

\paragraph*{Logging levels}


\begin{DoxyItemize}
\item {\ttfamily S\+I\+R\+L\+\_\+\+D\+E\+B\+UG} \+: For debugging information.
\item {\ttfamily S\+I\+R\+L\+\_\+\+E\+R\+R\+OR} \+: To report errors (non-\/fatal).
\item {\ttfamily S\+I\+R\+L\+\_\+\+W\+A\+R\+N\+I\+NG} \+: To report warnings or notifications.
\item {\ttfamily S\+I\+R\+L\+\_\+\+C\+R\+IT} \+: To report fatal errors.
\item {\ttfamily S\+I\+R\+L\+\_\+\+L\+OG} \+: For outputting logging data.
\item {\ttfamily S\+I\+R\+L\+\_\+\+S\+C\+R\+E\+EN} \+: For outputting information to the user. 
\end{DoxyItemize}